<html>

<head>
    <title>NASA Hackathon TW 2020</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Noto+Sans+TC">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Share+Tech+Mono">
    <link rel="stylesheet" href="assets/fontawesome/all.min.css">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" integrity="sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z" crossorigin="anonymous">
    <link rel="stylesheet" href="assets/css/index.css">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
</head>

<body>
    <div style="height: 30%;" class="p-4 container-fluid">
        <h1 class="text-center"><a href="https://2020.spaceappschallenge.org/locations/taipei/" target="_blank">NASA Hackathon TW 2020</a></h1>
        <div class="text-center">
            <p class="" id="time-counter">00:00</p>
        </div>
    </div>
    <div class="text-center d-flex justify-content-center align-items-center flex-column" id="timeline" style="height: 30%">
        <div id="timeline-bg"><div id="timeline-ft"></div></div>

    </div>
    <div class="container-fluid" id="informations">
        <div class="row h-100">
            <div class="col-12 col-lg-5">
                <div class="h-100" id="info-textbox">
                    <div class="p-2" id="message-list">
                    </div>
                    <div id="slack_count" style="position: absolute; left: 15px; top: calc(-1.5em - 2px); height: 1.5em; outline: 2px solid white;">
                        <a style="font-size: 1em; margin: 0; padding: 3px;"><i class="fas fa-user"></i><span>250</span></a>
                    </div>
                </div>
            </div>
            <div class="col-12 col-lg-4">
                <div class="p-2 h-100" id="info-count">
                    <ul>
                        <li id="doc_char_count">文件字數統計: <span></span></li>
                        <li id="slide_page_count">簡報頁數統計: <span></span></li>
                        <li id="council_time">專家諮詢統計: <span></span></li>
                        <li id="council_count">專家諮詢次數統計: <span></span></li>
                    </ul>
                </div>
            </div>
            <div class="col-12 col-lg-3 p-4 h-100" style="min-height: 5em;">
                <a href="https://2020.spaceappschallenge.org/locations/taipei/" target="_blank">
                    <div id="spaceapps-logo">
                    </div>
                </a>
            </div>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js" integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js" integrity="sha384-B4gt1jrGC7Jh4AgTPSdUtOBvfO8shuf57BaghqFfPlYxofvL8/KUEfYiJOMMV+rV" crossorigin="anonymous"></script>
    <script type="text/javascript">
        function pad(num, size) {
            return ('000000000' + num).substr(-size);
        }

        var targetDate = new Date().getTime() + (3*24*60*60*1000);
        var x = setInterval(function() {
            var now = new Date().getTime();
            var distance = targetDate - now;

            //var days = pad(Math.floor(distance / (1000 * 60 * 60 * 24)), 2);
            var hours = pad(Math.floor(distance / (1000 * 60 * 60)), 2);
            var minutes = pad(Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60)), 2);
            var seconds = pad(Math.floor((distance % (1000 * 60)) / 1000), 2);

            $("#time-counter").text(`${hours}:${minutes}:${seconds}`);

            if (distance < 0) {

            }
        }, 100);

        /*for(var i=0; i< 20; i++) {
            $("#message-list").append(`<p><a class="message-time">09/08 13:30</a><a class="message-content">: 一些求助文字文字文字動態動態</a></p>`);
        }*/

        //time_stamp, doc_char_count, slide_page_count, council_time, council_count, announcement, slack_count
        var info_list = ["doc_char_count", "slide_page_count", "council_time", "council_count"];
        var time_stamp = 0;
        function updatefile() {
            $.getJSON("https://meet.jothon.online/api/rpg/getroom?room=nasahackathon", function(result){
                if(result['data']['room_data']['updated_at'] <= time_stamp)
                    return;
                time_stamp = result['data']['room_data']['updated_at'];
                var data = result['data']['room_data']['data'];
                console.log(result);
                info_list.forEach((item, i) => {
                    if(data[item] != null){
                        $(`#${item} span`).text(data[item]);
                    }

                    if(data["announcement"] != null){
                        $("#message-list").html("");
                        data["announcement"].forEach((item, i) => {
                            $("#message-list").append(`<p><a class="message-time">${item.time}</a><a class="message-content">: ${item.text}</a></p>`);
                        });
                    }

                    if(data["slack_count"] != null){
                        $("#slack_count span").text(data["slack_count"]);
                    }
                });
            });
        }

        setInterval(updatefile, 1000);
    </script>
</body>

</html>
